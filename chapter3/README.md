# 3장

3장에서는 이러한 것들을 배운다.

- 코드에 유연성을 추가하고 유지보수성을 개선하는 데 도움을 주는 개방/폐쇄 원칙(OCP)
- 언제 인터페이스를 사용하면 좋을지를 설명하는 일반적인 가이드라인과 높은 결합도를 피할 수 있는 기법
- 언제 API에 예외를 포함하거나 포함하지 않을지를 결정하는 자바의 예외 처리 방법
- 검증된 빌드 도구(Maven, Gradle)를 이용해 자바 프로젝트를 시스템적으로 빌드하는 방법

## 추가된 입출금 내역 분석기 요구 사항

1. 특정 입출금 내역을 검색할 수 있는 기능. 예를 들어 주어진 날짜 범위 또는 특정 범주의 입출금 내역 얻기.
2. 검색 결과의 요약 통계를 text, HTML 등 다양한 형식으로 만들기.

## 개방/폐쇄 원칙

> **코드 중복 문제**
>
> 중복 코드는 소프트웨어를 불안정하게 만드는데, 특히 요구 사항이 자주 바뀔수록 영향이 커진다.

특정 여러 조건으로 입출금 내역 검색을 코드 중복으로 여러개의 매서드를 구현하는 경우 다음과 같은 문제가 발생한다.

- 여러 속성을 조합할수록 코드가 점점 복잡해진다.
- 반복 로직과 비즈니스 로직이 결합되어 분리하기 어려워진다.
- 코드를 반복한다.

계방/폐쇄 원칙을 적용하면 코드를 직접 바꾸지 않고 해당 메서드나 클래스의 동작을 바꿀 수 있다. 인터페이스를 이용해 반복 로직과 비즈니스 로직의 결합을 제거할 수 있다.

> **함수형 인터페이스**
>
> 한 개의 추상 메서드를 포함하는 인터페이스.<br/> `@FunctionalInterface` Annotation을 이용하면 인터페이스의 의도를 더 명확하게 표현할 수 있다.

- 새로운 인터페이스를 이용해 반복 로직과 비지니스 로직의 결합을 제거하는 과정이므로 이는 상당히 중요한 리팩터링이다.
  - 왜? 기존 메서드의 바디를 바꿀 필요 없이 새로운 구현을 인수로 전달하기 때문.
- 변경 없이도(**closed**) 확장성은 개방(**open**)된다.
- 이런 방식으로 기능을 확장하면 기존에 이미 구현하고 검증한 코드를 바꾸는 일을 최소화할 수 있으므로 새로운 _버그가 발생할 만한 대상을 줄일 수 있다_.

### 람다 표현식

- 함수형 인터페이스 인스턴스로 만들면 새로운 요구 사항이 있을 때마다 별도의 클래스를 만들어야한다.
- 자바8 부터 **람다 표현식**과 **메서드 레퍼런스**를 사용하여 이름 없는 인터페이스 구현 객체를 코드 블록 형태로 전달할 수 있다.
- 장점
  1. 기존 코드를 바꾸지 않으므로 기존 코드가 잘못될 가능성이 줄어든다.
  2. 코드가 중복되지 않으므로 기존 코드의 재사용성이 높아진다.
  3. 결합도가 낮아지므로 코드 유지보수성이 좋아진다.

## 인터페이스 문제

한 인터페이스에 모든 기능을 추가하는 갓 인터페이스(God Interface)를 만드는 일은 피해야한다.

### God Interface

구현해야 할 모든 기능을 인터페이스에 정의하면 생기는 문제점

- 모든 헬퍼 연산이 명시적인 API 정의에 포함되면서 인터페이스가 복잡해진다.
- 갓 클래스와 비슷한 갓 인터페이스가 만들어진다.
  - 자바의 인터페이스는 모든 구현이 지켜야할 규칙을 정의하고 구현 클래스는 인터페이스에서 정의한 모든 연산의 구현 코드를 제공해야 한다. **인터페이스를 바꾸면 이를 구현한(implement) 코드도 바뀐 내용을 지원하도록 갱신되어야 하므로** 문제가 발생할 수 있는 범위도 넓어진다.
  - 인터페이스가 도메인 객체의 특정 접근자에 종속되는 문제가 생기면 도메인 객체의 세부내용이 바뀜에 따라 인터페이스 코드도 바뀌어야 하는 문제점이 발생한다.

### 지나친 세밀함

지나치게 인터페이스가 세밀해도 코드 유지보수에 방해가 된다.
기능이 여러 인터페이스로 분산되므로 필요한 기능을 찾기가 어려운 **안티 응집도** 문제가 발생한다.

## 명시적 API vs 암묵적 API

구체적으로 메서드를 정의해야 하는지 의문이 생기는 딜레마를 `명시적 API vs 암묵적 API 제공 문제`라고 부른다.

1. 명시적 API

- 장점
  - 어떤 동작을 수행하는지 잘 설명되어 있고, 사용하기 쉽다.
- 단점
  - 이 메서드의 용도가 특정 상황에 국한되어 각 상황에 맞는 새로운 메서드를 많이 만들어야 하는 상황이 벌어진다.

2. 암묵적 API

- 장점
  - 거래 내역을 검색하는 데 필요한 모든 상황을 단순한 API로 처리할 수 있다.
- 단점
  - 처음 사용하기 어렵고, 문서화를 잘해놓아야 한다.

3. 그래서 어떤것을 사용해야하는데?

- 딱히 정답은 정해져 있지 않다. (질문의 종류에 따라 달라질 수 있음.)
- 명시적 API가 가장 흔히 사용하는 연산이라면 사용자가 쉽게 이해하고 사용하도록 만드는 것이 합리적인 방법.

### 도메인 클래스 vs 원싯값

인터페이스를 원시값으로 결과값을 반환하면 생기는 문제점

- 원싯값으로는 다양한 결과를 반환할 수 없어 유연성이 떨어진다.

해결방법

- 원시값(primitive type)을 감싸는 새 도메인 클래스(ex Summary)를 만들면 필요한 필드와 결과를 언제든 추가하여 해결할 수 있다.
- 이 기법을 이용하면 도메인의 다양한 개념간의 결합을 줄이고, 요구 사항이 바뀔 때 연쇄적으로 코드가 바뀌는 일도 최소화할 수 있다.

<hr/>

# 더 공부해야할 부분

- [ ] 함수형 인터페이스
- [ ] Predicate<T> 제네릭 인터페이스
- [ ] 람다표현식
- [ ] 메서드 레퍼런스
